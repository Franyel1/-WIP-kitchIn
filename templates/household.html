<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Jersey+10&family=Jersey+15&family=Josefin+Slab:ital,wght@0,100..700;1,100..700&family=Kristi&family=Lexend:wght@100..900&family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/styles.css">
    <title>Household</title>
</head>
<body id="householdScreen">
    <div id="topBar">
        <h2><a id='logo' href="{{ url_for('home') }}">kitchIn</a></h2>
        <a href="{{ url_for('logout') }}" class="button" id="logout">
            Logout
        </a>
        <a href="{{ url_for('requests') }}" class="button" id="requests">
            Requests
        </a>

    </div>

      <div id="householdName">{{household.name}}</div>

      <div id="panels">
        <div id="groceryPanel">
          <div id="grocery">
            <div>
              <h2>Grocery List</h2>
              <a href="#" id="groceryAdd" onclick="openAddGrocery()">+</a>
            </div>
            <ul>
              {% for item in grocery_list %}
                <li>
                  <div id="listBox">
                    <span id="item">{{ item.name }}</span>
                    <span id="price">{{ item.price }}$</span>
                    {% if item.requester_id == current_user_id %}
                      <a href="#" class="groceryEdit" data-id="{{ item._id }}">✎</a>
                      <a href="{{ url_for('removeGrocery', id=item._id) }}" id="groceryRemove">-</a>
                    {% endif %}
                  </div>
                  <div id="requester">Request by: {{ item.requester_username or 'unknown' }}</div>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      
        <div id="pantryPanel">
          <div id="pantry">
            <div>
              <h2>Pantry</h2>
              <a href="#" id="pantryAdd" onclick="openAddPantry()">+</a>
            </div>
            <ul>
              {% for item in pantry %}
                <li>
                  <div id="listBox">
                    <span id="item">{{ item.name }}</span>
                    <span id="quantity">{{ item.quantity }}</span>
                    {% if item.owner_id == current_user_id %}
                      <a href="#" class="pantryEdit" data-id="{{ item._id }}">✎</a>
                      <a href="{{ url_for('removePantry', id=item._id) }}" id="pantryRemove">-</a>
                    {% endif %}
                  </div>
                  <div id="expiry">exp: {{ item.expiration }}</div>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>      

    <div id="back">
        <div id="pantryEditBox">
            <h3>Edit Pantry Item</h3>
            <form id="editPantryForm" method="POST" action="/update-pantry">
                <div id="questions2">
                    <input type="hidden" name="id" id="pantryItemId">
                  
                    <label for="editName">Name:</label>
                    <input type="text" name="name" id="editName"><br><br>
                  
                    <label for="editQuantity">Quantity:</label>
                    <input type="text" name="quantity" id="editQuantity"><br><br>
                  
                    <label for="editExpiry">Expiration Date:</label>
                    <input type="text" name="expiration" id="editExpiry"><br>
                  </div>
                <button class="button"type="submit">Save</button>
                <button class="button"type="button"id="cancelButton" onclick="closePantryEditBox()">Cancel</button>
            </form>         
        </div>
        <div id="groceryEditBox">
            <h3>Edit Grocery Item</h3>
            <form id="editGroceryForm" method="POST" action="/update-grocery">
                <div id="questions">
                    <input type="hidden" name="id" id="groceryItemId">
                  
                    <label for="groceryEditName">Name:</label>
                    <input type="text" name="name" id="groceryEditName"><br><br>
                  
                    <label for="groceryEditPrice">Price:</label>
                    <input type="text" name="price" id="groceryEditPrice"><br><br>
                
                </div>
                <button class="button" type="submit">Save</button>
                <button class="button" id="cancelButton" type="button" onclick="closeGroceryEditBox()">Cancel</button>
            </form>
        </div>

        <!--TODO: fix the css for the add part-->
        <div id="groceryAddBox" style="display:none;">
            <h3>Add Grocery Item</h3>
            <form id="addGroceryForm" method="POST" action="/add-grocery">
              <div id="questions">
                <label for="addGroceryName">Name:</label>
                <input type="text" name="name" id="addGroceryName"><br><br>
          
                <label for="addGroceryPrice">Price:</label>
                <input type="text" name="price" id="addGroceryPrice"><br><br>
              </div>
              <button class="button" type="submit">Add</button>
              <button class="button" type="button" onclick="closeAddGrocery()">Cancel</button>
            </form>
          </div>
          <div id="pantryAddBox" style="display:none;">
            <h3>Add Pantry Item</h3>
            <form id="addPantryForm" method="POST" action="/add-pantry">
              <div id="questions2">
                <label for="addPantryName">Name:</label>
                <input type="text" name="name" id="addPantryName"><br><br>
          
                <label for="addPantryQuantity">Quantity:</label>
                <input type="text" name="quantity" id="addPantryQuantity"><br><br>
          
                <label for="addPantryExpiry">Expiration Date:</label>
                <input type="text" name="expiration" id="addPantryExpiry"><br>
              </div>
              <button class="button" type="submit">Add</button>
              <button class="button" type="button" onclick="closeAddPantry()">Cancel</button>
            </form>
          </div>
          
    </div>
      
      
      
<script>
// ============================
// Grocery Edit Logic
// ============================
let currentGroceryId = null;

function closeGroceryEditBox() {
    document.getElementById("groceryEditBox").style.display = "none";
    document.getElementById("back").style.display = "none";
}

let groceryEdits = document.querySelectorAll('.groceryEdit');

for (let i = 0; i < groceryEdits.length; i++) {
    groceryEdits[i].addEventListener('click', function (e) {
        e.preventDefault();
        currentGroceryId = this.dataset.id;

        const listItem = this.closest('li');

        const name = listItem.querySelector('#item')?.textContent || '';
        const price = listItem.querySelector('#price')?.textContent.replace('$', '') || '';
        const requesterText = listItem.querySelector('#requester')?.textContent || '';
        const requester = requesterText.replace('Request by: ', '').trim();

        document.getElementById("groceryItemId").value = currentGroceryId;
        document.getElementById("groceryEditName").value = name;
        document.getElementById("groceryEditPrice").value = price;

        document.getElementById("groceryEditBox").style.display = "flex";
        document.getElementById("back").style.display = "flex";
    });
}


// ============================
// Pantry Edit Logic
// ============================
let currentPantryId = null;

function closePantryEditBox() {
    document.getElementById("pantryEditBox").style.display = "none";
    document.getElementById("back").style.display = "none";
}

let pantryEdits = document.querySelectorAll('.pantryEdit');

for (let i = 0; i < pantryEdits.length; i++) {
    pantryEdits[i].addEventListener('click', function (e) {
        e.preventDefault();
        currentPantryId = this.dataset.id;

        const listItem = this.closest('li');

        const name = listItem.querySelector('#item')?.textContent || '';
        const quantity = listItem.querySelector('#quantity')?.textContent || '';
        const expiryText = listItem.querySelector('#expiry')?.textContent || '';
        const expiry = expiryText.replace('exp: ', '').trim();

        document.getElementById("pantryItemId").value = currentPantryId;
        document.getElementById("editName").value = name;
        document.getElementById("editQuantity").value = quantity;
        document.getElementById("editExpiry").value = expiry;

        document.getElementById("pantryEditBox").style.display = "flex";
        document.getElementById("back").style.display = "flex";
    });

}

function openAddGrocery() {
    document.getElementById("back").style.display = "flex";
    document.getElementById("groceryAddBox").style.display = "flex";
}
function closeAddGrocery() {
    document.getElementById("groceryAddBox").style.display = "none";
    document.getElementById("back").style.display = "none";
}

function openAddPantry() {
    document.getElementById("back").style.display = "flex";
    document.getElementById("pantryAddBox").style.display = "flex";
}
function closeAddPantry() {
    document.getElementById("pantryAddBox").style.display = "none";
    document.getElementById("back").style.display = "none";
}


</script>
  
</body>
</html>